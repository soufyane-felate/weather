const city = document.getElementById("city");
const searchForm = document.getElementById("searchForm");
const cityInput = document.getElementById("cityInput");
const temperature = document.getElementById("temperature");

// Fetch weather data based on latitude and longitude
async function getData2(latitude, longitude) {
  try {
    const oauthToken =
      "eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCJ9.eyJ2IjoxLCJ1c2VyIjoibm9jb21wYW55X25ldF9sZWFkZXIiLCJpc3MiOiJsb2dpbi5tZXRlb21hdGljcy5jb20iLCJleHAiOjE3Mzc1NjEyNDksInN1YiI6ImFjY2VzcyJ9.-G45SC4IUcwOIWs7P5nfBhIlGsdv9aP9CNxKmRV3j7Bb9a2h21jtQ8gdyhEefaKIujdmwOnyf8OXIOMq18le4Q";
    const response = await fetch(
      `https://api.meteomatics.com/2025-01-21T12:00:00Z/t_2m:C/${latitude},${longitude}/json`,
      {
        headers: { Authorization: `Bearer ${oauthToken}` },
      }
    );
    if (!response.ok) {
      throw new Error(
        `HTTP error! Status: ${response.status}, Status Text: ${response.statusText}`
      );
    }
    const data2 = await response.json();
    console.log(data2);
  } catch (error) {
    console.error("Error fetching data:", error.message);
  }
}

async function getData(cityname) {
  try {
    let header = new Headers();
    header.set("X-Api-Key", "lUIGfjAuln7SuSF2fzKpig==hqIA07DXQPrAW8ev");
    const response = await fetch(
      `https://api.api-ninjas.com/v1/city?name=${cityname}`,
      {
        headers: header,
      }
    );

    if (!response.ok) {
      throw new Error(`HTTP error! Status: ${response.status}`);
    }

    const data = await response.json();
    console.log("city", data);

    if (data.length > 0) {
      city.innerHTML = data[0].name;
      console.log(data[0].name);
      getData2(data[0].latitude, data[0].longitude);
    } else {
      city.innerHTML = "City not found";
    }
  } catch (error) {
    console.log("Error fetching city data:", error.message);
  }
}

// Search function to get the city name from input
function Citysearch() {
  let s = cityInput.value.trim();
  if (s) {
    getData(s);
  } else {
    city.innerHTML = "Please enter a city name.";
  }
}

search.addEventListener("submit", function (event) {
  event.preventDefault();
  Citysearch();
});
